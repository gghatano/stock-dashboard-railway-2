# 株価ダッシュボード システム仕様書

## 1. プロジェクト概要

### 1.1 システム名
株価ダッシュボード（Stock Dashboard）

### 1.2 目的
S&P500とFANG+インデックスの株価情報を円建て/ドル建てで表示し、直近14日間の価格推移を可視化するダッシュボードを提供する。

### 1.3 技術スタック
- **バックエンド**: FastAPI (Python)
- **フロントエンド**: React
- **データソース**: yfinance (Yahoo Finance API)
- **デプロイ**: Railway

### 1.4 主要機能
1. S&P500・FANG+インデックスの価格表示
2. 円建て/ドル建て表示の切り替え
3. 前日比（金額・%）の表示
4. 直近14日間の価格推移チャート（線グラフ）
5. ドル円為替レートの表示

---

## 2. 監視対象

### 2.1 インデックス

| ティッカー | 名称 | 説明 | 通貨 |
|-----------|------|------|------|
| ^GSPC | S&P 500 | 米国株式市場の主要500社 | USD |
| ^NYFANG | NYSE FANG+ | FANG+インデックス | USD |

### 2.2 為替レート

| ティッカー | 通貨ペア | 用途 |
|-----------|---------|------|
| USDJPY=X | ドル円 | USD→JPY換算 |

---

## 3. データ構造仕様

### 3.1 インデックス定義

```python
INDICES = {
    "^GSPC": {
        "name": "S&P 500",
        "currency": "USD"
    },
    "^NYFANG": {
        "name": "FANG+",
        "currency": "USD"
    }
}
```

### 3.2 APIレスポンス構造

```json
{
    "indices": [
        {
            "ticker": "^GSPC",
            "name": "S&P 500",
            "current_price": 5892.45,
            "previous_close": 5850.23,
            "change": 42.22,
            "change_percent": 0.72,
            "chart_data": [
                {"date": "2026-01-03", "close": 5750.12},
                {"date": "2026-01-06", "close": 5780.34},
                ...
            ],
            "last_update": "2026-01-17T10:30:00"
        },
        {
            "ticker": "^NYFANG",
            "name": "FANG+",
            "current_price": 12345.67,
            "previous_close": 12300.00,
            "change": 45.67,
            "change_percent": 0.37,
            "chart_data": [...],
            "last_update": "2026-01-17T10:30:00"
        }
    ],
    "exchange_rate": {
        "rate": 157.32,
        "last_update": "2026-01-17T10:30:00"
    },
    "timestamp": "2026-01-17T10:30:00+09:00"
}
```

### 3.3 チャートデータ構造

```python
[
    {
        "date": str,     # 日付（YYYY-MM-DD）
        "close": float   # 終値（USD）
    },
    # ... 14日分
]
```

---

## 4. API仕様

### 4.1 エンドポイント一覧

| メソッド | パス | 説明 | レスポンス形式 |
|---------|------|------|---------------|
| GET | `/api/indices` | インデックスデータ取得 | JSON |
| GET | `/health` | ヘルスチェック | JSON |

### 4.2 `/api/indices` - インデックスデータ取得

**リクエスト**:
```
GET /api/indices
```

**レスポンス**: 3.2節のAPIレスポンス構造を参照

### 4.3 `/health` - ヘルスチェック

**リクエスト**:
```
GET /health
```

**レスポンス**:
```json
{
    "status": "healthy",
    "timestamp": "2026-01-17T10:30:00+09:00"
}
```

---

## 5. 通貨表示機能の仕様

### 5.1 表示ルール

| 表示通貨 | マーク | 小数点桁数 | 例 |
|----------|--------|-----------|-----|
| JPY（デフォルト） | ¥ | 0桁 | ¥926,543 |
| USD | $ | 2桁 | $5,892.45 |

### 5.2 換算計算式

**USD → JPY**:
```
円建て価格 = ドル建て価格 × ドル円レート
例: $5,892.45 × 157.32 = ¥927,150
```

**前日比の換算**:
```
円建て前日比 = ドル建て前日比 × ドル円レート
例: $42.22 × 157.32 = ¥6,642
```

**騰落率**:
```
騰落率（%）は通貨に依存しない
例: 0.72% はそのまま
```

### 5.3 通貨切り替えUI仕様

**トグルスイッチ**:
- 位置: 画面右上
- 状態: 円 / USD
- デフォルト: 円
- 動作: クリックで即座に切り替え

---

## 6. UI/UX仕様

### 6.1 画面構成

```
┌─────────────────────────────────────────────────────────┐
│  株価ダッシュボード         USD/JPY: ¥157.32  [円|USD] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────┐  ┌─────────────────────┐      │
│  │ S&P 500             │  │ FANG+               │      │
│  │ ¥926,543            │  │ ¥1,942,345          │      │
│  │ +¥6,642 (+0.72%) ↑  │  │ -¥4,532 (-0.23%) ↓  │      │
│  ├─────────────────────┤  ├─────────────────────┤      │
│  │                     │  │                     │      │
│  │   📈 線グラフ       │  │   📈 線グラフ       │      │
│  │     (14日分)        │  │     (14日分)        │      │
│  │                     │  │                     │      │
│  └─────────────────────┘  └─────────────────────┘      │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 6.2 カード仕様

**構成要素**:
1. インデックス名
2. 現在価格（大きく表示）
3. 前日比（金額）
4. 騰落率（%）
5. 上昇/下落アイコン
6. 線グラフ（14日分）

**カラーコード**:
- 上昇: 緑系
- 下降: 赤系
- 変化なし: グレー系

### 6.3 チャート仕様

**種類**: 線グラフ
**期間**: 14日間の終値データ
**Y軸**: 通貨切替に連動（円 or ドル）

### 6.4 レスポンシブデザイン

- モバイル: 1列（縦並び）
- タブレット以上: 2列（横並び）

---

## 7. データ取得仕様

### 7.1 取得タイミング

- ページ読み込み時にyfinanceからデータ取得
- キャッシュなし（毎回最新データを取得）

### 7.2 取得期間

- 14日分の日次終値データ

### 7.3 エラーハンドリング

**データ取得エラー時**:
- エラーメッセージを表示
- 前回取得成功時のデータがあれば表示（フロントエンドキャッシュ）

---

## 8. デプロイメント仕様

### 8.1 環境

**プラットフォーム**: Railway

**構成**:
- バックエンド: FastAPI（Python）
- フロントエンド: React（静的ファイルとしてビルド）

### 8.2 環境変数

**必須**:
- `PORT`: Railwayが自動設定

### 8.3 依存パッケージ

**Python (requirements.txt)**:
```
fastapi
uvicorn[standard]
yfinance
```

**Node.js (package.json)**:
- react
- recharts（チャートライブラリ）
- その他必要なパッケージ

---

## 9. 制約事項

### 9.1 データ制約

- **取引時間外**: 前営業日の終値が表示される
- **データ精度**: yfinanceの精度に依存
- **FANG+インデックス**: ^NYFANGが取得できない場合は代替手段を検討

### 9.2 機能制約

- ログイン機能なし
- データベースなし
- リアルタイム更新なし（ページ読み込み時のみ）

---

## 10. 用語集

| 用語 | 説明 |
|------|------|
| S&P 500 | 米国の代表的な株価指数。主要500社で構成 |
| FANG+ | NYSE FANG+インデックス。主要テック企業で構成 |
| yfinance | Yahoo Finance APIのPythonラッパーライブラリ |
| Railway | クラウドデプロイメントプラットフォーム |
