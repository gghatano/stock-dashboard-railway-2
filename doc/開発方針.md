# 株価ダッシュボード 開発方針

## プロジェクト概要

S&P500とFANG+インデックスを円建て/ドル建てで表示するダッシュボードを構築する。

---

## 技術スタック

| 領域 | 技術 |
|------|------|
| バックエンド | FastAPI (Python) |
| フロントエンド | React |
| データ取得 | yfinance |
| チャート | Recharts |
| デプロイ | Railway |

---

## フェーズ一覧

| フェーズ | タスク名 | 状態 |
|---------|---------|------|
| Phase 1 | プロジェクト構成・環境構築 | 🟢 DONE |
| Phase 2 | MVP画面構築（ローカル） | 🟢 DONE |
| Phase 3 | Railway デプロイ | 🟡 IN_PROGRESS |
| Phase 4 | 通貨切り替え機能実装 | 🔵 TODO |
| Phase 5 | スタイリング・レスポンシブ対応 | 🔵 TODO |
| Phase 6 | テスト・バグ修正 | 🔵 TODO |

> **変更履歴**:
> - 旧 Phase 3〜4（フロントエンド基盤・UI）→ Phase 2 に統合済み
> - Railway デプロイを Phase 3 として独立（Railpack 対応が必要なため）

---

## Phase 1: プロジェクト構成・環境構築 🟢 DONE

**目的**: 開発環境とプロジェクト構造を整備

### タスク一覧

- [x] **タスク1-1**: バックエンドディレクトリ構成
  - `backend/` ディレクトリ作成
  - `backend/main.py` - FastAPIアプリケーション
  - `backend/pyproject.toml` - 依存パッケージ (uv使用)

- [x] **タスク1-2**: フロントエンドプロジェクト作成
  - `frontend/` ディレクトリにReactプロジェクト作成
  - 必要なパッケージインストール（recharts等）

- [x] **タスク1-3**: 開発環境確認
  - バックエンド起動確認
  - フロントエンド起動確認

### 完了条件

- [x] バックエンドが `http://localhost:8000` で起動
- [x] フロントエンドが `http://localhost:5173` で起動 (Viteデフォルト)
- [x] ディレクトリ構成が整っている

---

## Phase 2: MVP画面構築（ローカル） 🟢 DONE

**目的**: ローカルで動作するMVP画面を構築

**設計書**: `doc/tasks/phase2-mvp-deploy.md`

**デプロイ方式**: FastAPIが`frontend/dist`を静的配信

### サブタスク一覧

| # | タスク | 状態 |
|---|--------|------|
| 2-1 | 型定義作成 (`types/index.ts`) | 🟢 DONE |
| 2-2 | useIndicesDataフック（ダミーフォールバック付き） | 🟢 DONE |
| 2-3 | IndexCardコンポーネント | 🟢 DONE |
| 2-4 | PriceChartコンポーネント（Recharts） | 🟢 DONE |
| 2-5 | CurrencyToggleコンポーネント（枠のみ） | 🟢 DONE |
| 2-6 | App.tsxレイアウト統合 | 🟢 DONE |
| 2-7 | /api/indicesエンドポイント（yfinance+フォールバック） | 🟢 DONE |
| 2-8 | FastAPI静的配信設定 | 🟢 DONE |
| 2-9 | nixpacks.toml作成 | 🟢 DONE |
| 2-10 | 動作確認・README更新 | 🟢 DONE |

### 完了条件

- [x] `npm run build` が成功（frontend/dist生成）
- [x] `uvicorn backend.main:app` で起動
- [x] `/health` が `{"status":"healthy"}` を返す
- [x] `/api/indices` がJSON返却（実データ or フォールバック）
- [x] `/` で画面表示（2カード＋チャート）
- [x] API失敗時もUIが崩れない

---

## Phase 3: Railway デプロイ 🟡 IN_PROGRESS

**目的**: Railway にデプロイして外部公開

**問題**: Railway が Railpack を使用しており、nixpacks.toml が認識されない

### エラーログ

```
⚠ Script start.sh not found
✖ Railpack could not determine how to build the app.
```

### サブタスク一覧

| # | タスク | 状態 |
|---|--------|------|
| 3-1 | Railpack 対応設定ファイル作成 | 🔵 TODO |
| 3-2 | Railway ダッシュボードで設定確認 | 🔵 TODO |
| 3-3 | デプロイ実行・動作確認 | 🔵 TODO |

### 完了条件

- [ ] Railway 上でビルド成功
- [ ] 外部 URL で画面表示
- [ ] `/api/indices` が動作
- [ ] フォールバック時も画面が成立

## Phase 4: 通貨切り替え機能実装 🔵

**目的**: 円建て/ドル建て表示の切り替え機能

### タスク一覧

- [ ] **タスク4-1**: 通貨状態管理
  - `useState` で通貨モード管理
  - デフォルト: 円建て (JPY)

- [ ] **タスク4-2**: トグルスイッチUI
  - 円 / USD 切り替えスイッチ
  - ヘッダー右上に配置

- [ ] **タスク4-3**: 価格換算ロジック
  - USD→JPY換算関数
  - 前日比の換算
  - チャートデータの換算

- [ ] **タスク4-4**: 表示の動的更新
  - 通貨マーク切り替え（¥ / $）
  - 小数点桁数の調整
  - チャートY軸の更新

### 完了条件

- [ ] トグルスイッチで通貨切り替え可能
- [ ] 価格が正しく換算される
- [ ] チャートも換算に連動する
- [ ] 通貨マークが正しく表示される

---

## Phase 5: スタイリング・レスポンシブ対応 🔵

**目的**: UIの見た目を整え、レスポンシブ対応

### タスク一覧

- [ ] **タスク5-1**: 全体スタイリング
  - カラースキーム設定
  - フォント設定
  - 余白・間隔の調整

- [ ] **タスク5-2**: カードデザイン
  - シャドウ・ボーダー
  - ホバーエフェクト（任意）

- [ ] **タスク5-3**: レスポンシブ対応
  - モバイル: 1列表示
  - タブレット以上: 2列表示

- [ ] **タスク5-4**: ローディング・エラー表示
  - ローディングスピナー
  - エラーメッセージ表示

### 完了条件

- [ ] 見た目が整っている
- [ ] モバイルで正しく表示される
- [ ] ローディング中の表示がある

---

## Phase 6: テスト・バグ修正 🔵

**目的**: 品質保証と最終調整

### タスク一覧

- [ ] **タスク6-1**: 機能テスト
  - データ取得が正常に動作
  - 通貨切り替えが正常に動作
  - チャート表示が正常

- [ ] **タスク6-2**: エラーケーステスト
  - API取得失敗時の表示
  - FANG+インデックス取得失敗時の対応

- [ ] **タスク6-3**: レスポンシブテスト
  - モバイル表示確認
  - タブレット表示確認
  - デスクトップ表示確認

- [ ] **タスク6-4**: バグ修正
  - 発見されたバグの修正

### 完了条件

- [ ] 主要機能がすべて動作する
- [ ] 既知のバグがない
- [ ] 各デバイスで正しく表示される

---

## 進捗管理

### 現在の状態

- **現在のフェーズ**: Phase 3
- **進捗**: 2/6 フェーズ完了
- **次のタスク**: Phase 3 - Railway デプロイ（Railpack 対応）

> **備考**: Railway が Railpack を使用しており、nixpacks.toml が認識されない問題あり

### ステータス凡例

- 🔵 **TODO**: 未着手
- 🟡 **IN_PROGRESS**: 作業中
- 🟢 **DONE**: 完了
- ⚪ **HOLD**: 保留中
- 🔴 **BLOCKED**: ブロック中

---

## ディレクトリ構成（予定）

```
stock-dashboard-railway-2/
├── backend/
│   ├── main.py              # FastAPIアプリケーション
│   └── requirements.txt     # Python依存パッケージ
├── frontend/
│   ├── src/
│   │   ├── components/      # Reactコンポーネント
│   │   │   ├── IndexCard.tsx
│   │   │   ├── PriceChart.tsx
│   │   │   └── CurrencyToggle.tsx
│   │   ├── hooks/           # カスタムフック
│   │   │   └── useIndicesData.ts
│   │   ├── types/           # 型定義
│   │   │   └── index.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   └── vite.config.ts
├── doc/
│   ├── 仕様書.md
│   └── 開発方針.md
├── railway.toml
└── README.md
```

---

## 開発コマンド

### バックエンド

```bash
# ディレクトリ移動
cd backend

# 依存関係インストール
pip install -r requirements.txt

# 開発サーバー起動
uvicorn main:app --reload --port 8000
```

### フロントエンド

```bash
# ディレクトリ移動
cd frontend

# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev
```

---

## 注意事項

### FANG+インデックス (^NYFANG) について

- yfinanceで `^NYFANG` が取得できない可能性がある
- 取得できない場合の代替案:
  1. ICE FANG+ Index の別ティッカーを試す
  2. 主要FANG+銘柄の個別取得に切り替える

### 開発の原則

1. **段階的実装**: 各フェーズを完了してから次へ
2. **仕様書への準拠**: `/doc/仕様書.md` の内容を厳守
3. **エラーハンドリング**: すべてのAPI呼び出しでエラー処理
4. **レスポンシブ優先**: モバイルでも使いやすいUI
