# 株価ダッシュボード 開発方針

## プロジェクト概要

S&P500とFANG+インデックスを円建て/ドル建てで表示するダッシュボードを構築する。

---

## 技術スタック

| 領域 | 技術 |
|------|------|
| バックエンド | FastAPI (Python) |
| フロントエンド | React |
| データ取得 | yfinance |
| チャート | Recharts |
| デプロイ | Railway |

---

## フェーズ一覧

| フェーズ | タスク名 | 状態 |
|---------|---------|------|
| Phase 1 | プロジェクト構成・環境構築 | 🟢 DONE |
| Phase 2 | MVP画面構築＆Railwayデプロイ | 🟡 IN_PROGRESS |
| Phase 3 | ~~フロントエンド基盤構築~~ (Phase 2に統合) | - |
| Phase 4 | ~~カード・チャートUI実装~~ (Phase 2に統合) | - |
| Phase 5 | 通貨切り替え機能実装 | 🔵 TODO |
| Phase 6 | スタイリング・レスポンシブ対応 | 🔵 TODO |
| Phase 7 | ~~Railway デプロイ~~ (Phase 2に統合) | - |
| Phase 8 | テスト・バグ修正 | 🔵 TODO |

> **変更**: Phase 2〜4, 7を「Phase 2: MVP画面構築＆Railwayデプロイ」に統合。
> 理由: 最短でRailway公開し、外部から触れる状態を優先するため。

---

## Phase 1: プロジェクト構成・環境構築 🟢 DONE

**目的**: 開発環境とプロジェクト構造を整備

### タスク一覧

- [x] **タスク1-1**: バックエンドディレクトリ構成
  - `backend/` ディレクトリ作成
  - `backend/main.py` - FastAPIアプリケーション
  - `backend/pyproject.toml` - 依存パッケージ (uv使用)

- [x] **タスク1-2**: フロントエンドプロジェクト作成
  - `frontend/` ディレクトリにReactプロジェクト作成
  - 必要なパッケージインストール（recharts等）

- [x] **タスク1-3**: 開発環境確認
  - バックエンド起動確認
  - フロントエンド起動確認

### 完了条件

- [x] バックエンドが `http://localhost:8000` で起動
- [x] フロントエンドが `http://localhost:5173` で起動 (Viteデフォルト)
- [x] ディレクトリ構成が整っている

---

## Phase 2: MVP画面構築＆Railwayデプロイ 🟡 IN_PROGRESS

**目的**: 最短でRailwayに公開し、外部から触れる状態にする

**設計書**: `doc/tasks/phase2-mvp-deploy.md`

**デプロイ方式**: FastAPIが`frontend/dist`を静的配信（A方式）

### サブタスク一覧

| # | タスク | 状態 |
|---|--------|------|
| 2-1 | 型定義作成 (`types/index.ts`) | 🔵 TODO |
| 2-2 | useIndicesDataフック（ダミーフォールバック付き） | 🔵 TODO |
| 2-3 | IndexCardコンポーネント | 🔵 TODO |
| 2-4 | PriceChartコンポーネント（Recharts） | 🔵 TODO |
| 2-5 | CurrencyToggleコンポーネント（枠のみ） | 🔵 TODO |
| 2-6 | App.tsxレイアウト統合 | 🔵 TODO |
| 2-7 | /api/indicesエンドポイント（yfinance+フォールバック） | 🔵 TODO |
| 2-8 | FastAPI静的配信設定 | 🔵 TODO |
| 2-9 | nixpacks.toml作成（Railway設定） | 🔵 TODO |
| 2-10 | 動作確認・README更新 | 🔵 TODO |

### 完了条件

**ローカル**
- [ ] `npm run build` が成功（frontend/dist生成）
- [ ] `uvicorn backend.main:app` で起動
- [ ] `/health` が `{"status":"healthy"}` を返す
- [ ] `/api/indices` がJSON返却（実データ or フォールバック）
- [ ] `/` で画面表示（2カード＋チャート）
- [ ] API失敗時もUIが崩れない

**Railway**
- [ ] デプロイ成功
- [ ] 外部URLで画面表示
- [ ] `/api/indices` が動作
- [ ] 取得失敗でも画面が成立

---

## Phase 3: フロントエンド基盤構築 🔵

**目的**: Reactアプリの基本構造を構築

### タスク一覧

- [ ] **タスク3-1**: プロジェクト構成
  - `src/components/` - コンポーネント
  - `src/hooks/` - カスタムフック
  - `src/types/` - 型定義

- [ ] **タスク3-2**: API通信フック
  - `useIndicesData()` フック実装
  - ローディング状態管理
  - エラー状態管理

- [ ] **タスク3-3**: 型定義
  - `IndexData` 型
  - `ChartDataPoint` 型
  - `ExchangeRate` 型

- [ ] **タスク3-4**: 基本レイアウト
  - ヘッダー（タイトル、為替レート表示、通貨切替）
  - メインコンテンツエリア（カード2枚並列）

### 完了条件

- [ ] APIからデータ取得できる
- [ ] ローディング表示が動作する
- [ ] 基本レイアウトが表示される

---

## Phase 4: カード・チャートUI実装 🔵

**目的**: インデックスカードと線グラフを実装

### タスク一覧

- [ ] **タスク4-1**: IndexCardコンポーネント
  - インデックス名表示
  - 現在価格表示
  - 前日比（金額・%）表示
  - 上昇/下落の色分け

- [ ] **タスク4-2**: PriceChartコンポーネント
  - Rechartsを使用した線グラフ
  - 14日分のデータ表示
  - Y軸の価格表示

- [ ] **タスク4-3**: 2カードの並列表示
  - S&P500カード
  - FANG+カード
  - レスポンシブ対応（モバイルは縦並び）

### 完了条件

- [ ] 2つのカードが横並びで表示される
- [ ] 各カードに価格・前日比が表示される
- [ ] 線グラフが正しく描画される
- [ ] 上昇/下落で色が変わる

---

## Phase 5: 通貨切り替え機能実装 🔵

**目的**: 円建て/ドル建て表示の切り替え機能

### タスク一覧

- [ ] **タスク5-1**: 通貨状態管理
  - `useState` で通貨モード管理
  - デフォルト: 円建て (JPY)

- [ ] **タスク5-2**: トグルスイッチUI
  - 円 / USD 切り替えスイッチ
  - ヘッダー右上に配置

- [ ] **タスク5-3**: 価格換算ロジック
  - USD→JPY換算関数
  - 前日比の換算
  - チャートデータの換算

- [ ] **タスク5-4**: 表示の動的更新
  - 通貨マーク切り替え（¥ / $）
  - 小数点桁数の調整
  - チャートY軸の更新

### 完了条件

- [ ] トグルスイッチで通貨切り替え可能
- [ ] 価格が正しく換算される
- [ ] チャートも換算に連動する
- [ ] 通貨マークが正しく表示される

---

## Phase 6: スタイリング・レスポンシブ対応 🔵

**目的**: UIの見た目を整え、レスポンシブ対応

### タスク一覧

- [ ] **タスク6-1**: 全体スタイリング
  - カラースキーム設定
  - フォント設定
  - 余白・間隔の調整

- [ ] **タスク6-2**: カードデザイン
  - シャドウ・ボーダー
  - ホバーエフェクト（任意）

- [ ] **タスク6-3**: レスポンシブ対応
  - モバイル: 1列表示
  - タブレット以上: 2列表示

- [ ] **タスク6-4**: ローディング・エラー表示
  - ローディングスピナー
  - エラーメッセージ表示

### 完了条件

- [ ] 見た目が整っている
- [ ] モバイルで正しく表示される
- [ ] ローディング中の表示がある

---

## Phase 7: Railway デプロイ 🔵

**目的**: Railwayにデプロイして公開

### タスク一覧

- [ ] **タスク7-1**: ビルド設定
  - フロントエンドのビルド
  - バックエンドからの静的ファイル配信設定

- [ ] **タスク7-2**: Railway設定
  - `railway.toml` 作成
  - 環境変数設定

- [ ] **タスク7-3**: デプロイ実行
  - Railwayにデプロイ
  - 動作確認

### 完了条件

- [ ] Railway上でアプリが動作する
- [ ] 外部からアクセス可能
- [ ] データが正しく表示される

---

## Phase 8: テスト・バグ修正 🔵

**目的**: 品質保証と最終調整

### タスク一覧

- [ ] **タスク8-1**: 機能テスト
  - データ取得が正常に動作
  - 通貨切り替えが正常に動作
  - チャート表示が正常

- [ ] **タスク8-2**: エラーケーステスト
  - API取得失敗時の表示
  - FANG+インデックス取得失敗時の対応

- [ ] **タスク8-3**: レスポンシブテスト
  - モバイル表示確認
  - タブレット表示確認
  - デスクトップ表示確認

- [ ] **タスク8-4**: バグ修正
  - 発見されたバグの修正

### 完了条件

- [ ] 主要機能がすべて動作する
- [ ] 既知のバグがない
- [ ] 各デバイスで正しく表示される

---

## 進捗管理

### 現在の状態

- **現在のフェーズ**: Phase 2
- **進捗**: 1/5 フェーズ完了 (Phase 2〜4, 7を統合したため5フェーズに変更)
- **次のタスク**: Phase 2 - MVP画面構築＆Railwayデプロイ（設計書: `doc/tasks/phase2-mvp-deploy.md`）

### ステータス凡例

- 🔵 **TODO**: 未着手
- 🟡 **IN_PROGRESS**: 作業中
- 🟢 **DONE**: 完了
- ⚪ **HOLD**: 保留中
- 🔴 **BLOCKED**: ブロック中

---

## ディレクトリ構成（予定）

```
stock-dashboard-railway-2/
├── backend/
│   ├── main.py              # FastAPIアプリケーション
│   └── requirements.txt     # Python依存パッケージ
├── frontend/
│   ├── src/
│   │   ├── components/      # Reactコンポーネント
│   │   │   ├── IndexCard.tsx
│   │   │   ├── PriceChart.tsx
│   │   │   └── CurrencyToggle.tsx
│   │   ├── hooks/           # カスタムフック
│   │   │   └── useIndicesData.ts
│   │   ├── types/           # 型定義
│   │   │   └── index.ts
│   │   ├── App.tsx
│   │   └── main.tsx
│   ├── package.json
│   └── vite.config.ts
├── doc/
│   ├── 仕様書.md
│   └── 開発方針.md
├── railway.toml
└── README.md
```

---

## 開発コマンド

### バックエンド

```bash
# ディレクトリ移動
cd backend

# 依存関係インストール
pip install -r requirements.txt

# 開発サーバー起動
uvicorn main:app --reload --port 8000
```

### フロントエンド

```bash
# ディレクトリ移動
cd frontend

# 依存関係インストール
npm install

# 開発サーバー起動
npm run dev
```

---

## 注意事項

### FANG+インデックス (^NYFANG) について

- yfinanceで `^NYFANG` が取得できない可能性がある
- 取得できない場合の代替案:
  1. ICE FANG+ Index の別ティッカーを試す
  2. 主要FANG+銘柄の個別取得に切り替える

### 開発の原則

1. **段階的実装**: 各フェーズを完了してから次へ
2. **仕様書への準拠**: `/doc/仕様書.md` の内容を厳守
3. **エラーハンドリング**: すべてのAPI呼び出しでエラー処理
4. **レスポンシブ優先**: モバイルでも使いやすいUI
