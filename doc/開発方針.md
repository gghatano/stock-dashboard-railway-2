# 株価ダッシュボード 開発方針

## プロジェクト概要

S&P500とFANG+インデックスを円建て/ドル建てで表示するダッシュボードを構築する。

---

## 技術スタック

| 領域 | 技術 |
|------|------|
| バックエンド | FastAPI (Python) |
| フロントエンド | HTMX + Jinja2テンプレート |
| データ取得 | yfinance |
| チャート | Chart.js（CDN） |
| デプロイ | Railway |

---

## フェーズ一覧

| フェーズ | タスク名 | 状態 |
|---------|---------|------|
| Phase 1 | プロジェクト構成・環境構築 | 🔵 TODO |
| Phase 2 | バックエンドAPI + テンプレート基盤 | 🔵 TODO |
| Phase 3 | UI構築（カード・チャート） | 🔵 TODO |
| Phase 4 | 通貨切り替え機能 | 🔵 TODO |
| Phase 5 | スタイリング・レスポンシブ | 🔵 TODO |
| Phase 6 | Railwayデプロイ | 🔵 TODO |

---

## Phase 1: プロジェクト構成・環境構築 🔵 TODO

**目的**: HTMX版の開発環境を整備

### タスク一覧

- [ ] **タスク1-1**: バックエンド構成
  - `backend/main.py` - FastAPIアプリ
  - `backend/templates/` - Jinja2テンプレート
  - `backend/static/` - CSS/JS

- [ ] **タスク1-2**: 依存パッケージ設定
  - fastapi, uvicorn, jinja2, yfinance

- [ ] **タスク1-3**: 開発環境確認
  - サーバー起動確認

### 完了条件

- [ ] `http://localhost:8000` でページ表示
- [ ] `/health` が正常応答

---

## Phase 2: バックエンドAPI + テンプレート基盤 🔵 TODO

**目的**: データ取得とテンプレート配信の基盤構築

### タスク一覧

- [ ] **タスク2-1**: `/api/indices` エンドポイント
  - yfinanceでS&P500、FANG+、ドル円を取得
  - 14日分のチャートデータ含む

- [ ] **タスク2-2**: ベーステンプレート（`base.html`）
  - 共通レイアウト
  - HTMX/Chart.js CDN読み込み

- [ ] **タスク2-3**: メインページテンプレート（`index.html`）

### 完了条件

- [ ] `/api/indices` がJSONを返す
- [ ] `/` でHTMLページが表示される

---

## Phase 3: UI構築 🔵 TODO

**目的**: インデックスカードとチャートの表示

### タスク一覧

- [ ] **タスク3-1**: IndexCard部分テンプレート
  - インデックス名、価格、前日比表示
  - 上昇/下降の色分け

- [ ] **タスク3-2**: Chart.jsで線グラフ表示
  - 14日分の終値データ
  - レスポンシブ対応

- [ ] **タスク3-3**: メインページ統合
  - 2カード横並び（PC）/ 縦並び（モバイル）

### 完了条件

- [ ] S&P500とFANG+の2カードが表示される
- [ ] 各カードにチャートが描画される

---

## Phase 4: 通貨切り替え機能 🔵 TODO

**目的**: HTMXで円/USD表示の切り替え

### タスク一覧

- [ ] **タスク4-1**: 通貨切り替えエンドポイント
  - `GET /api/indices?currency=JPY|USD`
  - または部分テンプレート返却

- [ ] **タスク4-2**: トグルスイッチUI
  - HTMXで部分更新（hx-get, hx-swap）

- [ ] **タスク4-3**: 価格換算ロジック
  - USD→JPY換算
  - チャートデータの換算

### 完了条件

- [ ] トグルクリックで通貨切り替え
- [ ] ページリロードなしで価格更新
- [ ] チャートも連動して更新

---

## Phase 5: スタイリング・レスポンシブ 🔵 TODO

**目的**: UIの見た目を整える

### タスク一覧

- [ ] **タスク5-1**: CSSスタイリング
  - カラースキーム（上昇:緑、下降:赤）
  - カードデザイン
  - フォント設定

- [ ] **タスク5-2**: レスポンシブ対応
  - モバイル: 1列表示
  - タブレット以上: 2列表示

- [ ] **タスク5-3**: ローディング表示
  - HTMXリクエスト中のインジケーター

### 完了条件

- [ ] 見た目が整っている
- [ ] モバイルで正しく表示される

---

## Phase 6: Railwayデプロイ 🔵 TODO

**目的**: 本番環境へデプロイ

### タスク一覧

- [ ] **タスク6-1**: デプロイ設定ファイル
  - `railway.toml` または `Procfile`
  - 環境変数設定

- [ ] **タスク6-2**: デプロイ実行

- [ ] **タスク6-3**: 動作確認
  - 外部URLでアクセス
  - API/UI両方の確認

### 完了条件

- [ ] Railway上でビルド成功
- [ ] 外部URLで画面表示
- [ ] `/api/indices` が動作

---

## 進捗管理

### 現在の状態

- **現在のフェーズ**: Phase 1
- **進捗**: 0/6 フェーズ完了
- **次のタスク**: Phase 1 - プロジェクト構成・環境構築

### ステータス凡例

- 🔵 **TODO**: 未着手
- 🟡 **IN_PROGRESS**: 作業中
- 🟢 **DONE**: 完了
- ⚪ **HOLD**: 保留中
- 🔴 **BLOCKED**: ブロック中

---

## ディレクトリ構成（予定）

```
stock-dashboard-railway-2/
├── backend/
│   ├── main.py              # FastAPIアプリ
│   ├── templates/           # Jinja2テンプレート
│   │   ├── base.html
│   │   ├── index.html
│   │   └── components/
│   │       ├── index_card.html
│   │       └── price_chart.html
│   ├── static/              # 静的ファイル
│   │   └── css/
│   │       └── style.css
│   └── pyproject.toml       # uv用
├── doc/
│   ├── 仕様書.md
│   └── 開発方針.md
└── README.md
```

---

## 開発コマンド

### バックエンド

```bash
cd backend
uv run uvicorn main:app --reload --port 8000
```

### 動作確認

```bash
curl http://localhost:8000/health
curl http://localhost:8000/api/indices
open http://localhost:8000
```

---

## 注意事項

### FANG+インデックス (^NYFANG) について

- yfinanceで `^NYFANG` が取得できない可能性がある
- 取得できない場合はフォールバックデータを使用

### HTMXの利点

- JavaScriptビルド不要
- サーバーサイドレンダリングでシンプル
- 部分更新でSPA風のUX

### 開発の原則

1. **段階的実装**: 各フェーズを完了してから次へ
2. **仕様書への準拠**: `/doc/仕様書.md` の内容を厳守
3. **エラーハンドリング**: すべてのAPI呼び出しでエラー処理
